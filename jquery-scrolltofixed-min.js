!function(a){a.isScrollToFixed=function(b){return!!a(b).data("ScrollToFixed")},a.ScrollToFixed=function(b,c){function s(){f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed"),o=-1,l=f.offset().top,m=f.offset().left,d.options.offsets&&(m+=f.offset().left-f.position().left),-1==n&&(n=m),g=f.css("position"),e=!0,-1!=d.options.bottom&&(f.trigger("preFixed.ScrollToFixed"),x(),f.trigger("fixed.ScrollToFixed"))}function t(){var a=d.options.limit;return a?"function"==typeof a?a.apply(f):a:0}function u(){return"fixed"===g}function v(){return"absolute"===g}function w(){return!(u()||v())}function x(){if(!u()){var a=f[0].getBoundingClientRect();p.css({display:f.css("display"),width:a.width,height:a.height,"float":f.css("float")}),cssOptions={"z-index":d.options.zIndex,position:"fixed",top:-1==d.options.bottom?B():"",bottom:-1==d.options.bottom?"":d.options.bottom,"margin-left":"0px"},d.options.dontSetWidth||(cssOptions.width=f.css("width")),f.css(cssOptions),f.addClass(d.options.baseClassName),d.options.className&&f.addClass(d.options.className),g="fixed"}}function y(){var a=t(),b=m;d.options.removeOffsets&&(b="",a-=l),cssOptions={position:"absolute",top:a,left:b,"margin-left":"0px",bottom:""},d.options.dontSetWidth||(cssOptions.width=f.css("width")),f.css(cssOptions),p.css("display",f.css("display")),g="absolute"}function z(){w()||(o=-1,p.css("display","none"),f.css({"z-index":k,width:"",position:h,left:"",top:j,"margin-left":""}),f.removeClass("scroll-to-fixed-fixed"),d.options.className&&f.removeClass(d.options.className),g=null)}function A(a){a!=o&&(f.css("left",m-a),o=a)}function B(){var a=d.options.marginTop;return a?"function"==typeof a?a.apply(f):a:0}function C(){if(a.isScrollToFixed(f)&&!f.is(":hidden")){var b=e,c=w();e?w()&&(l=f.offset().top,m=f.offset().left):s();var g=a(window).scrollLeft(),i=a(window).scrollTop(),j=t();d.options.minWidth&&a(window).width()<d.options.minWidth?w()&&b||(E(),f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed")):d.options.maxWidth&&a(window).width()>d.options.maxWidth?w()&&b||(E(),f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed")):-1==d.options.bottom?j>0&&i>=j-B()?c||v()&&b||(E(),f.trigger("preAbsolute.ScrollToFixed"),y(),f.trigger("unfixed.ScrollToFixed")):i>=l-B()?(u()&&b||(E(),f.trigger("preFixed.ScrollToFixed"),x(),o=-1,f.trigger("fixed.ScrollToFixed")),A(g)):w()&&b||(E(),f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed")):j>0?i+a(window).height()-f.outerHeight(!0)>=j-(B()||-D())?u()&&(E(),f.trigger("preUnfixed.ScrollToFixed"),"absolute"===h?y():z(),f.trigger("unfixed.ScrollToFixed")):(u()||(E(),f.trigger("preFixed.ScrollToFixed"),x()),A(g),f.trigger("fixed.ScrollToFixed")):A(g)}}function D(){return d.options.bottom?d.options.bottom:0}function E(){var a=f.css("position");"absolute"==a?f.trigger("postAbsolute.ScrollToFixed"):"fixed"==a?f.trigger("postFixed.ScrollToFixed"):f.trigger("postUnfixed.ScrollToFixed")}var d=this;d.$el=a(b),d.el=b,d.$el.data("ScrollToFixed",d);var g,h,i,j,k,e=!1,f=d.$el,l=0,m=0,n=-1,o=-1,p=null,F=function(){f.is(":visible")&&(e=!1,C())},G=function(){window.requestAnimationFrame?requestAnimationFrame(C):C()},I=function(a){a=a||window.event,a.preventDefault&&a.preventDefault(),a.returnValue=!1};d.init=function(){d.options=a.extend({},a.ScrollToFixed.defaultOptions,c),k=f.css("z-index"),d.$el.css("z-index",d.options.zIndex),p=a("<div />"),g=f.css("position"),h=f.css("position"),i=f.css("float"),j=f.css("top"),w()&&d.$el.after(p),a(window).bind("resize.ScrollToFixed",F),a(window).bind("scroll.ScrollToFixed",G),"ontouchmove"in window&&a(window).bind("touchmove.ScrollToFixed",C),d.options.preFixed&&f.bind("preFixed.ScrollToFixed",d.options.preFixed),d.options.postFixed&&f.bind("postFixed.ScrollToFixed",d.options.postFixed),d.options.preUnfixed&&f.bind("preUnfixed.ScrollToFixed",d.options.preUnfixed),d.options.postUnfixed&&f.bind("postUnfixed.ScrollToFixed",d.options.postUnfixed),d.options.preAbsolute&&f.bind("preAbsolute.ScrollToFixed",d.options.preAbsolute),d.options.postAbsolute&&f.bind("postAbsolute.ScrollToFixed",d.options.postAbsolute),d.options.fixed&&f.bind("fixed.ScrollToFixed",d.options.fixed),d.options.unfixed&&f.bind("unfixed.ScrollToFixed",d.options.unfixed),d.options.spacerClass&&p.addClass(d.options.spacerClass),f.bind("resize.ScrollToFixed",function(){p.height(f.height())}),f.bind("scroll.ScrollToFixed",function(){f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed"),C()}),f.bind("detach.ScrollToFixed",function(b){I(b),f.trigger("preUnfixed.ScrollToFixed"),z(),f.trigger("unfixed.ScrollToFixed"),a(window).unbind("resize.ScrollToFixed",F),a(window).unbind("scroll.ScrollToFixed",G),f.unbind(".ScrollToFixed"),p.remove(),d.$el.removeData("ScrollToFixed")}),F()},d.init()},a.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"},a.fn.scrollToFixed=function(b){return this.each(function(){new a.ScrollToFixed(this,b)})}}(jQuery);